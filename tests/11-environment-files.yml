---
cases:
  - name: "can load .env file"
    files:
      .env: |
        NAME=bunster
        DESCRIPTION="
        A shell scripting programming language
        "
        REPO_NAME=${NAME}
        PROJECT_NAME="${NAME}"
        LANGUAGE_NAME=$NAME
        COMPILER_NAME="$NAME"
    script: |
      loadenv

      echo $NAME
      echo $DESCRIPTION
      echo $REPO_NAME
      echo $PROJECT_NAME
      echo $LANGUAGE_NAME
      echo $COMPILER_NAME
    expect:
      stdout: |
        bunster

        A shell scripting programming language

        bunster
        bunster
        bunster
        bunster

  - name: ".env with yaml syntax is supported"
    files:
      .env: |
        NAME: bunster
        DESCRIPTION: "
        A shell scripting programming language
        "
        REPO_NAME: ${NAME}
        PROJECT_NAME: "${NAME}"
        LANGUAGE_NAME: $NAME
        COMPILER_NAME: "$NAME"
    script: |
      loadenv

      echo $NAME
      echo $DESCRIPTION
      echo $REPO_NAME
      echo $PROJECT_NAME
      echo $LANGUAGE_NAME
      echo $COMPILER_NAME
    expect:
      stdout: |
        bunster

        A shell scripting programming language

        bunster
        bunster
        bunster
        bunster

  - name: "can load custom .env file"
    files:
      custom.env: |
        KEY=value
    script: |
      loadenv custom.env

      echo $KEY
    expect:
      stdout: |
        value

  - name: "can load multiple  .env files"
    files:
      default.env: |
        KEY1=value1
        KEY2=value2
      extra.env: |
        KEY1=value3
        KEY3=value4
    script: |
      loadenv default.env extra.env

      echo $KEY1 $KEY2 $KEY3
    expect:
      stdout: |
        value3 value2 value4

  - name: "cannot load non-existing .env files"
    script: |
      loadenv
      loadenv file.env
    expect:
      exit_code: 1
      stderr: |
        loadenv: open .env: no such file or directory
        loadenv: open file.env: no such file or directory

  - name: "exit code is zero on success"
    files:
      .env: |
        KEY=value
    script: |
      false
      loadenv
    expect:
      exit_code: 0
